<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VR播放</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/playvr.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="header">
      <div class="header-c">
        <div id="main-navbar" class="container">
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                      <span class="sr-only">Toggle navigation</span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                  </button>
                  <a id="logo" title="Start..." class="navbar-brand" href="#">
                      <img src="../images/common/logo1.png" alt="miaovr Logo">
                  </a>
                  <div class="clearfix"></div>
              </div>
              <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1" aria-expanded="false">
                  <ul class="nav navbar-nav navbar-left">
                      <li>
                          <a href="../index.html">首页</a>
                      </li>
                      <li>
                          <a href="./vrinfo.html">VR资讯</a>
                      </li>
                      <li class="choose">
                          <a href="./vrtv.html">VRTV</a>
                      </li>
                      <li>
                          <a href="./vrgame.html">VR游戏</a>
                      </li>
                      <li>
                          <a href="./community.html">VR社区</a>
                      </li>
                  </ul>

                  <ul class="nav navbar-nav navbar-right">
                      <li>
                        <a href="http://miaomiaotv.cn/index.html">
                          <img src="../images/common/mobile.png" alt='' class="img-responsive nav-r-icon"/>
                          <p class="nav-r-name">客户端</p>
                        </a>
                      </li>
                      <li>
                        <a href="./upload.html">
                          <img src="../images/common/upload.png" alt='' class="img-responsive nav-r-icon"/>
                          <p class="nav-r-name">上传视频</p>
                        </a>
                      </li>
                      <li>
                        <a href="./history.html">
                          <img src="../images/common/history.png" alt='' class="img-responsive nav-r-icon"/>
                          <p class="nav-r-name">历史观看</p>
                        </a>
                      </li>
                      <li class="header-login">
                        <a href="./login.html">
                          <img src="../images/common/man.png" alt='' class="img-responsive nav-r-icon"/>
                          <p class="nav-r-name">登陆/注册</p>
                        </a>
                      </li>
                      <li class="user-status">
                        <a href="./userCenter.html">
                          <img src="../images/common/default.png" width=50 alt="用户头像" class="img-responsive header-user-icon inb" onerror="userImgErr(this)">
                        </a>
                        <span class="arrow"></span>
                        <div class="user-hidden-box">
                          <span class="header-user-name inb"></span>
                          <p class="exit-box">
                            <a href="./userCenter.html">个人中心</a>
                            <span class="h-line"></span>
                            <a href="javascript:void(0);"class="exit">退出</a>
                          </p>
                        </div>
                      </li>
                      <li class="search-i">
                        <form class="form-search" action="./search.html" onSubmit="return searchConfirm();">
                          <span class="input-search-box">
                            <input type="text" name="search_txt" id="t-search" class="input-search">
                          </span><span class="btn-search-box">
                            <input type="submit" value="搜索" id="btn-search" class="btn-search">
                          </span>
                        </form>
                      </li>
                  </ul>

              </div>
              <!-- end of navbar-collapse -->
            </div>
            <!-- end of container-fluid -->
          </nav>
        </div>
      </div>
      <div class="header-bottom-line"></div>
    </div>
    <div class="container">
      <div class="vr-player-box">
        <div id="detu_container" style="height: 100%;width: 100%;"></div>
      </div>
      <div class="vr-video-info">
        <div class="row">
          <div class="col-sm-9">
            <div class="vr-video-basic">
              <div class="row">
                <div class="col-sm-4">
                  <div class="vr-video-icon">
                    <img src="#" id="pic_url" class="img-responsive"/>
                  </div>
                  <div class="download-box">
                    <a class="btn-download inb" href="javascript:void(0);">
                      <span class="icon inb"></span>
                    </a>
                  </div>
                </div>
                <div class="col-sm-8">
                  <div class="video-title" id="showname"></div>
                  <p class="video-item basic">
                    <span>发布时间:</span>
                    <span class="date val" id="uploadtime">未知</span>
                    <span>文件大小:</span>
                    <span class="f-size val" id="filesize">未知</span>
                    <span>视频语言:</span>
                    <span class="lang val">中文</span>
                  </p>
                  <p class="video-item">
                    <span>作&nbsp;&nbsp;者:</span>
                    <span class="author val">未知</span>
                  </p>

                  <p class="video-item">
                    <span>视频类型:</span>
                    <span class="video-type">
                      <span class="video-type-tag" id="category-0">美女</span>
                      <span class="video-type-tag" id="category-1">风景</span>
                      <span class="video-type-tag" id="category-2">动画</span>
                      <span class="video-type-tag" id="category-3">电影</span>
                      <span class="video-type-tag" id="category-4">惊险</span>
                      <span class="video-type-tag" id="category-5">游戏</span>
                      <span class="video-type-tag" id="category-6">惊悚</span>
                      <span class="video-type-tag" id="category-7">音乐</span>
                    </span>
                  </p>

                </div>
              </div>
              <div class="vr-video-bottom">
                <div class="vr-video-description">
                  <p class="title">
                    <span class="ver-line inb"></span>
                    <span class="t">视频描述</span>
                  </p>
                  <div class="hor-line"></div>
                  <p class="content" id="description"></p>
                </div>
                <div class="vr-video-comment">
                  <p class="title">
                    <span class="ver-line inb"></span>
                    <span class="t">视频点评</span>
                  </p>
                  <div class="comment-main">
                    <textarea class="commment-body" autocomplete="off" id="tv-comment" name="comment">请输入评论内容</textarea>
                    <div class="btn-group">
                      <span class="comment-tips">最多可输入64个字</span>
                      <input type="submit" value="发布" class="btn-publish">
                    </div>
                  </div>
                </div>
                <div class="comments-box" id="user-comments-box">
                  <div class="mask-loading">
                    <div class="loading-icon"></div>
                  </div>
                  <ul class="comments-list" id="c-comment-box">
                  </ul>
                  <div class="pagination-box" id="pagination"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-3">
            <div class="other-videos-box">
              <div class="other-videos-title">
                相关视频
              </div>
              <div id="other-video-aside">
                <div class="mask-loading">
                  <div class="loading-icon"></div>
                </div>
                <div class="other-video">
                  <a href="http://127.0.0.1:8080/miaovr/views/playvr.html?vid=">
                    <div class="other-video-icon">
                      <img src="#" class="img-responsive">
                    </div>
                    <p class="other-video-title">相关视频</p>                    
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-3">
            <img src="../images/common/logo2.png" class="img-responsive footer-logo">
          </div>
          <div class="col-sm-6">
            <div class="row">
              <a href="./vrinfo.html" class="col-sm-3 footer-menu">
                VR资讯
              </a>
              <a href="./vrtv.html" class="col-sm-3 footer-menu">
                VRTV
              </a>
              <a href="./vrgame.html" class="col-sm-3 footer-menu">
                VR游戏
              </a>
              <a href="./community.html" class="col-sm-3 footer-menu">
                VR社区
              </a>
            </div>
            <div class="footer-link content-center">
              <div class="footer-link-line"></div>
              <div class="row">
                <div class="col-sm-12">
                  <span>关于我们</span>
                  <span class="sperate-line">-</span>
                  <span>法律申明</span>
                  <span class="sperate-line">-</span>
                  <span>免责申明</span>
                  <span class="sperate-line">-</span>
                  <span>隐私条款</span>
                  <span class="sperate-line">-</span>
                  <span>商务合作</span>
                </div>
              </div>
            </div>
          </div>  
          <div class="col-sm-3">
            <img src="../images/common/wx.png" class="img-responsive">
          </div>
        </div>
      </div> 
      <!--end of container-->
      <div class="coryright content-center">
        <div class="container">
          <div class="row">
           <div class="col-sm-12">
              <span class="coryright-s1">2016 瞄瞄互娱科技有限公司版权所有  沪ICP备12012543号-1</span>
            </div>
          </div>
          <div class="row">
           <div class="col-sm-12">
              <span class="coryright-s2">国内专业VR播放技术服务供应商</span>
            </div>
          </div>
        </div>
      </div> 
    </div>
    <div class="a-login-box">
      <form action="/v1/account_password_login.php" class="a-login-form" id="login-form">
        <p class="a-login-title">
          账号登陆
        </p>
        <p class="a-login-item">
          <input type="text" role-type="mobile" role-null="请输入手机号" role-err="请检查手机号码格式" class="inp" placeholder="手机号" id="uname">
        </p>
        <p class="a-login-item">
          <input type="password" role-type="pass" name="pass" role-null="请输入密码" role-err="密码包含数字字母或者下划线，6~16位长度" class="inp" placeholder="密码" id="pass">
        </p>
        <p class="a-login-item">
          <input type="submit" value="登录" id="btn-login" class="btn-login">
        </p>
        <p class="a-login-item login-item-register">
          没有账号?<a href="./register.html" class="register">免费注册</a>
        </p>
      </form>
    </div>
    <!--end of footer-->
    <script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../js/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <script type="text/javascript" src="../js/comment.js"></script>
    <script type="text/javascript" src="../js/login.js"></script>
    <script type="text/javascript" src="http://media.qicdn.detu.com/@/sdk-1.2.0/sdk.js"></script>
    <script type="text/javascript" src="../js/jPages.min.js"></script>
    <script type="text/javascript">
      var vid="";
      var queryParam={};
      $(document).ready(function(){
        Base.initHeaderUser();
        vid=Base.searchParam("vid","id");
        if(!vid){
          Base.showAlert("抱歉,你所查找的资源不存在","error");
          Base.errorBack("user-comments-box");
          return;
        }else{
          queryParam.fileid=vid;
          //查询视频信息
          Base.excuteAjax("/search/fileid","POST",{"fileid":vid},function(data){
            if(Base.isSuccess(data)&&data.list_result.length>0){
              var info=data.list_result[0];
              $("#category-"+info.category).css("display","inherit");
              $("#pic_url").attr("src",info.pic_url);
              if(info.filesize){
                $("#filesize").html(Math.floor(info.filesize/1024/1024)+"M");
              }
              $("#uploadtime").html(info.uploadtime);
              $("#showname").html(info.showname);
              $("#description").html(info.description||"暂无");
              config.videos[0].video=info.http_url;
              detupano(config);
              var comments=info.bfVodComments;
              if(comments.length>0){
                $(".pagination-box").css("display","block");
                comment.displayData(comments);
              }else{
                $("#user-comments-box").find(".mask-loading").fadeOut();
              }
            }else{
              Base.showAlert(data.error_msg,"error");
              Base.errorBack("user-comments-box");
            }
          },function(err){
            Base.errorBack("user-comments-box");
          });
          //查询相关视频
          Base.excuteAjax("/search/category?offset=0&length=5","POST",{"category":"0"},function(data){
            if(Base.isSuccess(data)){
              if(data.list_result.length<1){
                  $(".other-video").css("display","none");
                  $("#other-video-aside").find(".mask-loading").fadeOut();
              }else{
                Base.handleResult("other-video-aside",data,
                {"childrenBox":".other-video",
                 "img":"img",
                "txt":".other-video-title",
                "href":"a"},
                {"img":"pic_url",
                "txt":"showname",
                "href":"fileid"});                
              }
            }else{
              Base.showAlert(data.error_msg,"error");
              Base.errorBack("other-video-aside");
            }
          },function(err){
            Base.errorBack("other-video-aside");
          });
          comment.init({
              "query":"/vod/comment/fileId",
              "publish":"/vod/comment/vod",
              "reply":"/vod/comment/reply",
              "nameId":"fileid",
              "id":vid,
              "textArea":".commment-body",
              "loginCallBack":readyColHis
          });
          
        }
      });
      var vrPano=null;
      var config = {
          target: "detu_container",
          islive: false,
          videos:[
            {name: "bq", txt: "标清", video: "", play: true}
          ],
          ready: function(pano){
            pano.gyro(true);
            vrPano=pano;
            if(Base.isLogin()){
              readyColHis();
            }
          }
      };
      function readyColHis(){
        hisAdd(false);
        startLoop();
      }
      function startLoop(){
        setTimeout(hisAdd.bind(this,true),10000);
      }
      function hisAdd(flag){
        var uuid=Base.getUUID();
        if(uuid){
          timeLine=getTimeLine();
          if(timeLine!=null){
            Base.excuteAjax("/bfVodHistory/add","POST",{"uuid":Base.getUUID(),"fileid":vid,"timeLine":timeLine},function(data){
              if(Base.isSuccess(data)&&flag){
                startLoop();
              }
            },function(err){
            });
          }else{
            startLoop();
          }
        }
      }
      var timeLine=-10;
      function getTimeLine(){
        if(!vrPano){
          timeLine=null;
        }else{
          if(!timeLine){
            timeLine=-10;
          }
          var txt=vrPano.krpano.innerText;
          if(txt){
            timeLine=getTimeSeconds(txt.split("\n")[0]);
          }else{
            timeLine+=10;
          }
        }
        return timeLine;
      }
      function getTimeSeconds(time){
        var t=time.split(":");
        var seconds=0;
        for(var i=t.length-1;i>0;i--){
          seconds+=parseInt(t[i])*Math.pow(60,(t.length-i-1));
        }
        return seconds;
      }
    </script>
  </body>
</html>
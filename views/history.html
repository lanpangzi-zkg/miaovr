<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>观看历史</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/common.css" rel="stylesheet">
    <link href="../css/history.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="header">
      <div id="main-navbar" class="container">
        <nav class="navbar navbar-default">
          <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a id="logo" title="Start..." class="navbar-brand" href="#">
                    <img src="../images/common/logo1.png" alt="miaovr Logo">
                </a>
                <div class="clearfix"></div>
            </div>
            <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1" aria-expanded="false">
                <ul class="nav navbar-nav navbar-left">
                    <li>
                        <a href="../index.html">首页</a>
                    </li>
                    <li>
                        <a href="./vrinfo.html">VR资讯</a>
                    </li>
                    <li>
                        <a href="./vrtv.html">VRTV</a>
                    </li>
                    <li>
                        <a href="./vrgame.html">VR游戏</a>
                    </li>
                    <li>
                        <a href="./community.html">VR社区</a>
                    </li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li>
                      <a href="http://miaomiaotv.cn/index.html">
                        <img src="../images/common/mobile.png" alt='' class="img-responsive nav-r-icon"/>
                        <p class="nav-r-name">客户端</p>
                      </a>
                    </li>
                    <li>
                      <a href="./upload.html">
                        <img src="../images/common/upload.png" alt='' class="img-responsive nav-r-icon"/>
                        <p class="nav-r-name">上传视频</p>
                      </a>
                    </li>
                    <li>
                      <a href="./history.html">
                        <img src="../images/common/history.png" alt='' class="img-responsive nav-r-icon"/>
                        <p class="nav-r-name">历史观看</p>
                      </a>
                    </li>
                    <li class="header-login">
                      <a href="./login.html">
                        <img src="../images/common/man.png" alt='' class="img-responsive nav-r-icon"/>
                        <p class="nav-r-name">登陆/注册</p>
                      </a>
                    </li>
                    <li class="user-status">
                      <a href="./userCenter.html">
                        <img src="../images/comDetails/user-icon.png" width=50 alt="用户头像" class="img-responsive header-user-icon inb" onerror="userImgErr(this)">
                      </a>
                      <span class="arrow"></span>
                      <div class="user-hidden-box">
                        <span class="header-user-name inb"></span>
                        <p class="exit-box">
                          <a href="./userCenter.html">个人中心</a>
                          <span class="h-line"></span>
                          <a href="javascript:void(0);"class="exit">退出</a>
                        </p>
                      </div>
                    </li>
                    <li class="search-i">
                      <form class="form-search" action="./search.html" onSubmit="return searchConfirm();">
                        <span class="input-search-box">
                          <input type="text" name="search_txt" id="t-search" class="input-search">
                        </span><span class="btn-search-box">
                          <input type="submit" value="搜索" id="btn-search" class="btn-search">
                        </span>
                      </form>
                    </li>
                </ul>
            </div>
            <!-- end of navbar-collapse -->
          </div>
          <!-- end of container-fluid -->
        </nav>
      </div>
    </div>    
    <div class="container history-box">
      <div class="history-header">
        <span>记录了我的<span id="history-count">0</span>条记录</span>
        <span class="delete-box">
          <i class="delete-icon inb"></i>
          <span>清空我的观看记录</span>
        </span>
        <div class="delete-dialog">
          <p class="title">确定要清除所有记录吗</p>
          <div class="history-btn-group">
            <input type="button" class="btn-h btn-yes">
            <input type="button" class="btn-h btn-cancel">            
          </div>
        </div>
      </div>
      <div class="history-details">
        <div class="history-list">
          <div class="history-time-box">
            <div class="time-line">
              <span class="time-tag inb">一周内</span>
              <div class="time-axis">
                <div class="time-dot-box">
                  <i class="time-dot inb"></i>
                </div>
                <div class="ver-line">
                </div>
              </div>
            </div>
            <ul class="time-details">
            </ul>
          </div>
          <div class="history-time-box">
            <div class="time-line">
              <span class="time-tag inb">一月内</span>
              <div class="time-axis">
                <div class="time-dot-box">
                  <i class="time-dot inb"></i>
                </div>
                <div class="ver-line">
                </div>
              </div>
            </div>
            <ul class="time-details">
            </ul>
          </div>
          <div class="history-time-box">
            <div class="time-line">
              <span class="time-tag inb">一年内</span>
              <div class="time-axis">
                <div class="time-dot-box">
                  <i class="time-dot inb"></i>
                </div>
                <div class="ver-line">
                </div>
              </div>
            </div>
            <ul class="time-details">
            </ul>
          </div>
          <div class="history-time-box">
            <div class="time-line">
              <span class="time-tag inb">一年前</span>
              <div class="time-axis">
                <div class="time-dot-box">
                  <i class="time-dot inb"></i>
                </div>
                <div class="ver-line">
                </div>
              </div>
            </div>
            <ul class="time-details">
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-3">
            <img src="../images/common/logo2.png" class="img-responsive footer-logo">
          </div>
          <div class="col-sm-6">
            <div class="row">
              <div class="col-sm-3 footer-menu">
                VR资讯
              </div>
              <div class="col-sm-3 footer-menu">
                VR TV
              </div>
              <div class="col-sm-3 footer-menu">
                VR 游戏
              </div>
              <div class="col-sm-3 footer-menu">
                VR社区
              </div>
            </div>
            <div class="footer-link content-center">
              <div class="footer-link-line"></div>
              <div class="row">
                <div class="col-sm-12">
                  <span>关于我们</span>
                  <span class="sperate-line">-</span>
                  <span>法律申明</span>
                  <span class="sperate-line">-</span>
                  <span>免责申明</span>
                  <span class="sperate-line">-</span>
                  <span>隐私条款</span>
                  <span class="sperate-line">-</span>
                  <span>商务合作</span>
                </div>
              </div>
            </div>
          </div>  
          <div class="col-sm-3">
            <img src="../images/common/wx.png" class="img-responsive">
          </div>
        </div>
      </div> 
      <!--end of container-->
      <div class="coryright content-center">
        <div class="container">
          <div class="row">
           <div class="col-sm-12">
              <span class="coryright-s1">2016 瞄瞄互娱科技有限公司版权所有  沪ICP备12012543号-1</span>
            </div>
          </div>
          <div class="row">
           <div class="col-sm-12">
              <span class="coryright-s2">国内专业VR播放技术服务供应商</span>
            </div>
          </div>
        </div>
      </div> 
    </div>
    <div class="a-login-box">
      <form action="/v1/account_password_login.php" class="a-login-form" id="login-form">
        <p class="a-login-title">
          账号登陆
        </p>
        <p class="a-login-item">
          <input type="text" role-type="mobile" role-null="请输入手机号" role-err="请检查手机号码格式" class="inp" placeholder="手机号" id="uname">
        </p>
        <p class="a-login-item">
          <input type="password" role-type="pass" name="pass" role-null="请输入密码" role-err="密码包含数字字母或者下划线，6~16位长度" class="inp" placeholder="密码" id="pass">
        </p>
        <p class="a-login-item">
          <input type="submit" value="登录" id="btn-login" class="btn-login">
        </p>
        <p class="a-login-item">
          没有账号?<a href="./register.html" class="register">免费注册</a>
        </p>
      </form>
    </div>
    <div class="mask delete-mask">
      <span class="tips">删除中......</span>
    </div>
    <!--end of footer-->
    <script type="text/javascript" src="../js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../js/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <script type="text/javascript" src="../js/login.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        Base.initHeaderUser();
        if(!Base.isLogin()){
          LoginValid.init("login-form",function(data){
            $(".login-mask").click();
            init();
          });
          Base.showLoginBox();
        }else{
          init();
        }
      });
      var $dialog=null;
      function init(){
        $(".delete-box").on("click",function(){
          if(!$dialog){
            $dialog=$(".delete-dialog");
          }
          if($dialog.css("display")=="none"){
            $dialog.css("display","block");
          }else{
            $dialog.css("display","none");            
          }
        });
        //删除单个历史记录
        $(".history-time-box").delegate(".delete-icon","click",function(e){
          e.preventDefault();
          e.stopPropagation();
          deleteHistory($(this).attr("role-target"));
        });
        //删除所有历史记录
        $(".btn-yes").on("click",function(){
          if($(".his-item").length>0){
            deleteAllHistory();
          }else{
            $dialog.css("display","none");
          }
        });
        $(".btn-cancel").on("click",function(){
          $dialog.css("display","none");
        });
        queryHistory();
      }
      function deleteAllHistory(){
        
      }
      var mask=null;
      function deleteHistory(fileid){
        if(!mask){
          mask=$(".delete-mask");
        }
        mask.css("height",$(document).height()).fadeIn();
        Base.queryData("/bfVodHistory/remove","POST",{"uuid":Base.getUUID(),"fileid":fileid},function(data){
          if(Base.isSuccess(data)){
            $("#"+fileid).remove();
            mask.fadeOut();
            Base.showAlert("删除成功");
          }else{
            mask.fadeOut();
            Base.showAlert(data.error_msg,"error");
          }
        },function(err){
          mask.fadeOut();
          Base.showAlert(err,"error");
        });
        $dialog.css("display","none");
      }
      function queryHistory(){
        Base.queryData("/bfVodHistory/uuid","POST",{"uuid":Base.getUUID()},function(data){
          if(Base.isSuccess(data)){
            console.log(data);
            var list=data.list_result;
            if(list.length>0){
              var historyTimeBox=$(".history-list>.history-time-box");
              var temp=null;
              var $target=null;
              for(var i=0,j=list.length;i<j;i++){
                temp=list[i];
                $target=$(historyTimeBox[checkTime(temp.updateTime)]);
                if($target.css("display")==="none"){
                  $target.css("display","block");
                }
                handleHisItem($target.children(".time-details"),temp);
              }
            }
          }else{
            Base.showAlert(data.error_msg,"error");
          }
        },function(err){
          console.log(err);
          Base.showAlert(err,"error");
        });
      }
      function handleHisItem($parent,data){
        var title=data.bfVod.showname;
        title=title.length>20?title.slice(0,20)+"...":title;
        var $item=$("<li class='inb his-item' id='"+data.fileid+"'>"+
                  "<a href='./playvr.html?vid="+data.fileid+"'><img src='"+data.bfVod.pic_url+
                  "'role-data='../images/history/his.jpg'"+
                  "class='img-responsive' alt='#'><div class='play'>"+
                  "<div class='icon'></div></div><span class='delete-icon' role-target='"+data.fileid+"'></span></a>"+
                  "<p class='his-title'>"+title+"</p>"+
                  "</li>");
        $item.appendTo($parent);
      }
      function checkTime(longTime){
        var off=new Date()-longTime;
        var hours=off/1000/3600;
        var day=hours/24;
        if(Math.floor(day)<7){
          return 0;
        }else if(Math.floor(day)<30){
          return 1;
        }else if(Math.floor(day)<365){
          return 2;
        }else{
          return 3;
        }
      }
    </script>
  </body>
</html>